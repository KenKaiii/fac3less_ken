"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CaptionTimingService=void 0;const CaptionTextProcessor_1=require("./CaptionTextProcessor");class CaptionTimingService{textProcessor;constructor(){this.textProcessor=new CaptionTextProcessor_1.CaptionTextProcessor}async generateFromAdjustedTranscripts(t,e=42,s){const n=[];for(const r of t){const t=this.textProcessor.splitIntoSingleLineSegments(r.text,e),i=this.calculateSegmentTiming(t,r,s);for(let e=0;e<t.length;e++)n.push({text:t[e],startTime:r.startTime+i[e].startOffset,endTime:r.startTime+i[e].endOffset})}return n}calculateSegmentTiming(t,e,s){const n=e.endTime-e.startTime,r=[],i=t.map(t=>this.calculateSegmentWeight(t)),o=i.reduce((t,e)=>t+e,0),c=s||.2;let a=0;for(let e=0;e<t.length;e++){const t=n*(i[e]/o),s=0===e?Math.max(0,a-c):a,l=a+t-.05;r.push({startOffset:s,endOffset:l}),a+=t}return r.length>0&&(r[r.length-1].endOffset=n),r}calculateSegmentWeight(t){const e=t.split(/\s+/).filter(t=>t.length>0).length;let s=0;s+=.5*(t.match(/[.!?]/g)||[]).length;s+=.2*(t.match(/[,;]/g)||[]).length;s+=.3*(t.match(/[:—–-]/g)||[]).length;return e/2.5+s}applyStyling(t,e,s,n){return t.map(t=>({...t,style:{position:e||"bottom",fontSize:s||24,color:n||"#FFFFFF"}}))}}exports.CaptionTimingService=CaptionTimingService;